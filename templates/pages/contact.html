{% extends 'base.html' %}
{% load widget_tweaks %}

{% block title %}Contact - André Bellemare{% endblock %}
{% block meta_description %}Contactez André Bellemare, artiste peintre à Boucherville. Questions, demandes d'achat ou simplement pour échanger sur l'art.{% endblock %}

{% block json_ld %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "ContactPage",
    "name": "Contact - André Bellemare",
    "description": "Contactez André Bellemare, artiste peintre à Boucherville. Questions, demandes d'achat ou simplement pour échanger sur l'art.",
    "url": "{{ site_url }}{{ request.path }}",
    "mainEntity": {
        "@type": "Person",
        "name": "André Bellemare",
        "jobTitle": "Artiste peintre",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Boucherville",
            "addressRegion": "QC",
            "addressCountry": "CA"
        },
        "email": "{{ contact_email|default:'' }}"
    }
}
</script>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-2 sm:px-4 md:px-6 lg:px-8 py-12">
    <!-- Breadcrumb -->
    <nav class="mb-8 text-sm scroll-fade-in">
        <ol class="flex items-center space-x-2 text-warm-500">
            <li><a href="{% url 'core:home' %}" class="hover:text-charcoal dark:hover:text-white">Accueil</a></li>
            <li><span>/</span></li>
            <li class="text-charcoal dark:text-white">Contact</li>
        </ol>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12">
        <!-- Contact Form -->
        <div class="scroll-fade-in w-full min-w-0">
            <h1 class="font-display text-4xl text-charcoal dark:text-white mb-4">Me contacter</h1>
            <p class="text-warm-600 dark:text-warm-400 mb-8">
                Une question sur une toile? Un projet en tête? N'hésitez pas à m'écrire,
                je vous répondrai dans les plus brefs délais.
            </p>

            {% if success %}
            <div class="bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-xl p-6 mb-8">
                <div class="flex items-center">
                    <svg class="w-5 h-5 text-green-600 dark:text-green-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <div>
                        <h3 class="font-semibold text-green-800 dark:text-green-200">Message envoyé!</h3>
                        <p class="text-green-700 dark:text-green-300 text-sm">Je vous répondrai dans les plus brefs délais.</p>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if form.non_field_errors %}
            <div class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-xl p-6 mb-8">
                <div class="flex items-center">
                    <svg class="w-5 h-5 text-red-600 dark:text-red-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <div>
                        <h3 class="font-semibold text-red-800 dark:text-red-200">Erreur lors de l'envoi</h3>
                        <ul class="text-red-700 dark:text-red-300 text-sm mt-1">
                            {% for error in form.non_field_errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            {% endif %}

            <form method="post" id="contact-form" class="space-y-5 md:space-y-6 w-full">
                {% csrf_token %}

                <div class="field-wrapper">
                    <label for="id_name" class="block text-sm font-semibold text-charcoal dark:text-warm-200 mb-2">
                        Nom complet <span class="text-red-500">*</span>
                    </label>
                    {% render_field form.name class="form-input" id="id_name" %}
                    <div class="error-container" data-field="name">
                        {% if form.name.errors %}
                        <p class="field-error">
                            {{ form.name.errors.0 }}
                        </p>
                        {% endif %}
                    </div>
                </div>

                <div class="field-wrapper">
                    <label for="id_email" class="block text-sm font-semibold text-charcoal dark:text-warm-200 mb-2">
                        Courriel <span class="text-red-500">*</span>
                    </label>
                    {% render_field form.email class="form-input" id="id_email" %}
                    <div class="error-container" data-field="email">
                        {% if form.email.errors %}
                        <p class="field-error">
                            {{ form.email.errors.0 }}
                        </p>
                        {% endif %}
                    </div>
                </div>

                <div class="field-wrapper">
                    <label for="id_phone" class="block text-sm font-semibold text-charcoal dark:text-warm-200 mb-2">
                        Téléphone
                    </label>
                    {% render_field form.phone class="form-input" id="id_phone" %}
                    <div class="error-container" data-field="phone"></div>
                </div>

                <div class="field-wrapper">
                    <label for="id_message" class="block text-sm font-semibold text-charcoal dark:text-warm-200 mb-2">
                        Message <span class="text-red-500">*</span>
                    </label>
                    {% render_field form.message class="form-textarea" rows="6" id="id_message" %}
                    <div class="error-container" data-field="message">
                        {% if form.message.errors %}
                        <p class="field-error">
                            {{ form.message.errors.0 }}
                        </p>
                        {% endif %}
                    </div>
                </div>

                <button type="submit" id="submit-btn" class="w-full py-4 px-6 bg-charcoal dark:bg-warm-600 text-white rounded-xl text-base font-semibold hover:bg-warm-700 dark:hover:bg-warm-500 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                    Envoyer le message
                </button>
            </form>
        </div>

        <!-- Contact Info -->
        <div class="lg:pl-8 scroll-fade-in-card" data-delay="1">
            <div class="bg-warm-50 dark:bg-warm-800 rounded-2xl p-8 mb-8">
                <h2 class="font-display text-2xl text-charcoal dark:text-white mb-6">Coordonnées</h2>

                <div class="space-y-6">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-12 h-12 bg-white dark:bg-warm-700 rounded-full flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-warm-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-medium text-charcoal dark:text-white">Adresse</h3>
                            <a href="https://www.google.com/maps/place/Docteur+Andre+Bellemare/@45.5850848,-73.4466295,17z/data=!3m1!4b1!4m6!3m5!1s0x4cc902cdf1b6b407:0xa192375f34aaefd1!8m2!3d45.5850848!4d-73.4440546!16s%2Fg%2F1ts1m7h_?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA2OUgBUAM%3D" target="_blank" rel="noopener" class="text-warm-600 dark:text-warm-400 hover:text-charcoal dark:hover:text-white transition-colors">{{ contact_address }}</a>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-12 h-12 bg-white dark:bg-warm-700 rounded-full flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-warm-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-medium text-charcoal dark:text-white">Téléphone</h3>
                            <a href="tel:{{ contact_phone }}" class="text-warm-600 dark:text-warm-400 hover:text-charcoal dark:hover:text-white transition-colors">
                                {{ contact_phone }}
                            </a>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-12 h-12 bg-white dark:bg-warm-700 rounded-full flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-warm-500" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-medium text-charcoal dark:text-white">Facebook</h3>
                            <a href="{{ contact_facebook }}" target="_blank" rel="noopener" class="text-warm-600 dark:text-warm-400 hover:text-charcoal dark:hover:text-white transition-colors">
                                @andrebellemareartiste
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="bg-white dark:bg-warm-800 rounded-2xl p-8 border border-warm-200 dark:border-warm-700">
                <h3 class="font-display text-xl text-charcoal dark:text-white mb-4">Questions fréquentes</h3>
                <p class="text-warm-600 dark:text-warm-400 mb-4">
                    Consultez notre FAQ pour trouver rapidement des réponses à vos questions.
                </p>
                <a href="{% url 'core:faq' %}" class="inline-flex items-center text-charcoal dark:text-warm-200 font-medium hover:text-warm-600 dark:hover:text-white transition-colors">
                    Voir la FAQ
                    <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(function() {
    const form = document.getElementById('contact-form');
    if (!form) return;

    // Get form fields
    const nameField = document.getElementById('id_name');
    const emailField = document.getElementById('id_email');
    const phoneField = document.getElementById('id_phone');
    const messageField = document.getElementById('id_message');
    const submitBtn = document.getElementById('submit-btn');

    // Validation functions
    function validateName(value) {
        value = value.trim();
        if (!value) {
            return 'Le nom est requis.';
        }
        if (value.length < 2) {
            return 'Le nom doit contenir au moins 2 caractères.';
        }
        if (value.length > 100) {
            return 'Le nom ne peut pas dépasser 100 caractères.';
        }
        return null;
    }

    function validateEmail(value) {
        value = value.trim();
        if (!value) {
            return 'Le courriel est requis.';
        }
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
            return 'Veuillez entrer une adresse courriel valide.';
        }
        return null;
    }

    function validatePhone(value) {
        value = value.trim();
        if (value && value.length > 0) {
            // Allow various phone formats: digits, spaces, dashes, parentheses, plus sign
            const phoneRegex = /^[\d\s\-\+\(\)]+$/;
            if (!phoneRegex.test(value)) {
                return 'Le format du téléphone est invalide.';
            }
            // Check if there are at least 7 digits (minimum for a phone number)
            const digitCount = value.replace(/\D/g, '').length;
            if (digitCount > 0 && digitCount < 7) {
                return 'Le numéro de téléphone doit contenir au moins 7 chiffres.';
            }
            if (digitCount > 20) {
                return 'Le numéro de téléphone ne peut pas dépasser 20 chiffres.';
            }
        }
        return null;
    }

    function validateMessage(value) {
        value = value.trim();
        if (!value) {
            return 'Le message est requis.';
        }
        if (value.length < 10) {
            return 'Le message doit contenir au moins 10 caractères.';
        }
        return null;
    }

    // Show error function
    function showError(field, errorMessage) {
        const fieldWrapper = field.closest('.field-wrapper');
        if (!fieldWrapper) return;

        field.classList.add('error-field');
        const errorContainer = fieldWrapper.querySelector('.error-container');
        if (errorContainer) {
            errorContainer.innerHTML = errorMessage ? `
                <p class="field-error">
                    ${errorMessage}
                </p>
            ` : '';
        }
    }

    // Clear error function
    function clearError(field) {
        field.classList.remove('error-field');
        const fieldWrapper = field.closest('.field-wrapper');
        if (fieldWrapper) {
            const errorContainer = fieldWrapper.querySelector('.error-container');
            if (errorContainer) {
                errorContainer.innerHTML = '';
            }
        }
    }

    // Validate field function
    function validateField(field, validator) {
        const error = validator(field.value);
        if (error) {
            showError(field, error);
            return false;
        } else {
            clearError(field);
            return true;
        }
    }

    // Real-time validation on input (debounced for better UX)
    let validationTimeouts = {};

    function setupRealTimeValidation(field, validator) {
        field.addEventListener('input', function() {
            // Clear previous timeout
            if (validationTimeouts[field.id]) {
                clearTimeout(validationTimeouts[field.id]);
            }

            // Only validate if field has been touched (has content or was focused)
            if (field.value.trim().length > 0 || field.classList.contains('touched')) {
                // Debounce validation
                validationTimeouts[field.id] = setTimeout(() => {
                    validateField(field, validator);
                }, 300);
            }
        });

        // Mark field as touched on focus
        field.addEventListener('focus', function() {
            field.classList.add('touched');
        });

        // Full validation on blur
        field.addEventListener('blur', function() {
            field.classList.add('touched');
            validateField(field, validator);
        });
    }

    // Setup validation for each field
    setupRealTimeValidation(nameField, validateName);
    setupRealTimeValidation(emailField, validateEmail);
    setupRealTimeValidation(phoneField, validatePhone);
    setupRealTimeValidation(messageField, validateMessage);

    // Form submission validation
    form.addEventListener('submit', function(e) {
        let isValid = true;

        // Validate all required fields
        if (!validateField(nameField, validateName)) isValid = false;
        if (!validateField(emailField, validateEmail)) isValid = false;
        if (!validateField(phoneField, validatePhone)) isValid = false;
        if (!validateField(messageField, validateMessage)) isValid = false;

        if (!isValid) {
            e.preventDefault();
            // Scroll to first error
            const firstError = form.querySelector('.error-field');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                firstError.focus();
            }
            return false;
        }

        // Disable submit button to prevent double submission
        submitBtn.disabled = true;
        submitBtn.textContent = 'Envoi en cours...';
    });

    // Mark fields with server-side errors as touched on page load
    // This allows users to see server errors first, then validate as they type
    document.addEventListener('DOMContentLoaded', function() {
        // If there are server-side errors, mark fields as touched so validation works properly
        const fieldsWithErrors = form.querySelectorAll('input.error-field, textarea.error-field');
        fieldsWithErrors.forEach(function(field) {
            field.classList.add('touched');
        });

        // Intersection Observer for scroll animations
        const sections = document.querySelectorAll('.scroll-fade-in, .scroll-fade-in-card');

        const observerOptions = {
            threshold: 0.15,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const delay = entry.target.dataset.delay ? parseInt(entry.target.dataset.delay) * 100 : 0;
                    setTimeout(() => {
                        entry.target.classList.add('visible');
                    }, delay);
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        sections.forEach(section => {
            observer.observe(section);
        });

        // Check if sections are already visible on load
        function checkInitialVisibility() {
            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                const isVisible = rect.top < window.innerHeight * 0.8 && rect.bottom > 0;
                if (isVisible && !section.classList.contains('visible')) {
                    section.classList.add('visible');
                }
            });
        }

        checkInitialVisibility();
        setTimeout(checkInitialVisibility, 100);
    });
})();
</script>
{% endblock %}

{% block extra_css %}
<style>
    /* Scroll fade in animation */
    .scroll-fade-in {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }

    .scroll-fade-in.visible {
        opacity: 1;
        transform: translateY(0);
    }

    .scroll-fade-in-card {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }

    .scroll-fade-in-card.visible {
        opacity: 1;
        transform: translateY(0);
    }
</style>
{% endblock %}
