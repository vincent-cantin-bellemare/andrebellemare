{% extends 'base.html' %}
{% load static thumbnail %}

{% block title %}La Maison du Père - André Bellemare{% endblock %}
{% block meta_description %}Découvrez le partenariat avec la Maison du Père et les toiles vendues au profit de cet organisme qui vient en aide aux personnes en situation d'itinérance à Montréal.{% endblock %}

{% block json_ld %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "La Maison du Père - André Bellemare",
    "description": "Partenariat avec la Maison du Père et toiles vendues au profit de cet organisme.",
    "url": "{{ site_url }}{{ request.path }}"
}
</script>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Breadcrumb -->
    <nav class="mb-8 text-sm scroll-fade-in">
        <ol class="flex items-center space-x-2 text-warm-500">
            <li><a href="{% url 'core:home' %}" class="hover:text-charcoal dark:hover:text-white">Accueil</a></li>
            <li><span>/</span></li>
            <li class="text-charcoal dark:text-white">La Maison du Père</li>
        </ol>
    </nav>

    <article class="prose prose-lg prose-warm dark:prose-invert max-w-none">
        <h1 class="font-display text-4xl md:text-5xl text-charcoal dark:text-white mb-8 scroll-fade-in transition-all duration-500">La Maison du Père</h1>

        <h2 class="font-display text-3xl md:text-4xl font-semibold text-charcoal dark:text-white mb-6 mt-12 scroll-fade-in transition-all duration-500">Un art engagé</h2>
        <p>
            Chaque toile que vous accueillez chez vous est bien plus qu'une œuvre d'art.
            C'est un geste de générosité. Pour acquérir une de mes toiles, il vous suffit
            de faire un don du montant indiqué à la <strong><a href="https://maisondupere.org/" target="_blank" rel="noopener" class="hover:text-warm-600 dark:hover:text-warm-300 transition-colors">Maison du Père</a></strong>,
            un organisme qui vient en aide aux personnes en situation d'itinérance à Montréal.
        </p>
        <p>
            Et savoir que mes toiles vont égayer vos foyers tout en offrant du réconfort
            à ceux qui n'ont ni toit, ni salon... me touche profondément. Tout le monde y gagne:
            vous recevez une œuvre unique et ensemble nous aidons ceux qui en ont le plus besoin.
        </p>

        <div class="my-12 scroll-fade-in-card" data-delay="1">
            <img src="{% static 'images/andre_maison_du_pere.png' %}"
                 alt="André Bellemare à la Maison du Père avec ses toiles"
                 class="w-full max-w-2xl mx-auto rounded-2xl shadow-lg">
        </div>

        <div class="not-prose bg-warm-50 dark:bg-warm-800 rounded-2xl p-8 mb-12 scroll-fade-in-card" data-delay="2">
            <div class="flex justify-center mb-6">
                <a href="https://maisondupere.org/" target="_blank" rel="noopener" class="hover:opacity-80 transition-opacity duration-300">
                    <img src="{% static 'images/maison_du_pere.svg' %}"
                         alt="Maison du Père"
                         class="h-16 md:h-20 w-auto">
                </a>
            </div>
            <p class="text-lg text-warm-700 dark:text-warm-300 leading-relaxed text-center mb-4">
                Je suis fier de m'associer à la <strong><a href="https://maisondupere.org/" target="_blank" rel="noopener" class="text-charcoal dark:text-white hover:text-warm-600 dark:hover:text-warm-300 transition-colors">Maison du Père</a></strong>.
                Chaque achat de toile est un don qui va directement à cet organisme
                qui vient en aide aux personnes en situation d'itinérance à Montréal.
            </p>
            <p class="text-warm-600 dark:text-warm-400 text-center mb-6">
                Ensemble, nous pouvons faire une différence, une toile à la fois.
            </p>
            <div class="text-center">
                <a href="https://wl.donorperfect.net/weblink/weblink.aspx?name=E363220QF&id=2&utm_campaign=un-toit-un-r%C3%A9seau&utm_medium=pop-up&utm_source=maison-du-p%C3%A8re"
                   target="_blank"
                   rel="noopener"
                   class="inline-flex items-center px-6 py-3 bg-warm-600 dark:bg-warm-500 text-white rounded-lg font-medium hover:bg-warm-700 dark:hover:bg-warm-600 transition-all duration-300 hover:scale-105 hover:shadow-lg transform">
                    Faire un don à la Maison du Père
                    <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                    </svg>
                </a>
            </div>
        </div>

        {% if available_paintings %}
        <h2 class="font-display text-3xl md:text-4xl font-semibold text-charcoal dark:text-white mb-6 mt-16 scroll-fade-in transition-all duration-500">Toiles disponibles</h2>
        <p class="text-warm-600 dark:text-warm-400 mb-6 scroll-fade-in transition-all duration-500">Découvrez les toiles en vente au profit de la Maison du Père</p>
        {% endif %}
    </article>
</div>

<!-- Available Paintings Gallery -->
{% if available_paintings %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-16">
        {% for painting in available_paintings %}
        <div class="scroll-fade-in-card" data-delay="{{ forloop.counter0 }}">
            {% include 'components/painting_card.html' with painting=painting %}
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <article class="prose prose-lg prose-warm dark:prose-invert max-w-none">
        <h2 class="font-display text-3xl md:text-4xl font-semibold text-charcoal dark:text-white mb-6 mt-16 scroll-fade-in transition-all duration-500">Toiles vendues au profit de la Maison du Père</h2>
        {% if sold_paintings %}
        <p class="text-warm-600 dark:text-warm-400 mb-8 scroll-fade-in transition-all duration-500">{{ page_obj.paginator.count }} toile{{ page_obj.paginator.count|pluralize }} ont trouvé preneur</p>
        {% endif %}
    </article>
</div>

<!-- Sold Paintings Gallery -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
    {% if sold_paintings %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-12">
        {% for painting in sold_paintings %}
        <div class="scroll-fade-in-card" data-delay="{{ forloop.counter0 }}">
            {% include 'components/painting_card.html' with painting=painting %}
        </div>
        {% endfor %}
    </div>

    {% if page_obj.has_other_pages %}
    <nav class="flex justify-center">
        <ul class="flex items-center gap-2">
            {% if page_obj.has_previous %}
            <li>
                <a href="?page={{ page_obj.previous_page_number }}"
                   class="px-4 py-2 rounded-lg border border-warm-200 dark:border-warm-600 hover:bg-warm-50 dark:hover:bg-warm-700">
                    Précédent
                </a>
            </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <li><span class="px-4 py-2 rounded-lg bg-charcoal dark:bg-warm-600 text-white">{{ num }}</span></li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <li>
                <a href="?page={{ num }}"
                   class="px-4 py-2 rounded-lg border border-warm-200 dark:border-warm-600 hover:bg-warm-50 dark:hover:bg-warm-700">
                    {{ num }}
                </a>
            </li>
            {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            <li>
                <a href="?page={{ page_obj.next_page_number }}"
                   class="px-4 py-2 rounded-lg border border-warm-200 dark:border-warm-600 hover:bg-warm-50 dark:hover:bg-warm-700">
                    Suivant
                </a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}

    {% else %}
    <div class="text-center py-16 scroll-fade-in">
        <svg class="w-16 h-16 mx-auto text-warm-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        <p class="text-warm-500">Aucune toile vendue pour le moment.</p>
        <p class="text-warm-500 text-sm mt-2">Les toiles vendues au profit de la Maison du Père apparaîtront ici.</p>
    </div>
    {% endif %}
</div>

<!-- Nos acheteurs -->
{% if buyers_paintings %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <h2 class="font-display text-3xl md:text-4xl font-semibold text-charcoal dark:text-white mb-8 scroll-fade-in transition-all duration-500">Nos acheteurs</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for painting in buyers_paintings %}
        <div class="bg-white dark:bg-warm-800 rounded-xl p-6 shadow-sm hover:shadow-lg transition-shadow scroll-fade-in-card" data-delay="{{ forloop.counter0 }}">
            <div class="flex gap-4">
                <a href="{{ painting.get_absolute_url }}" class="flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden bg-warm-200 dark:bg-warm-700">
                    {% if painting.primary_image %}
                    {% thumbnail painting.primary_image.image "160x160" crop="center" as thumb %}
                    <img src="{{ thumb.url }}" alt="{{ painting.title }}" class="w-full h-full object-cover">
                    {% endthumbnail %}
                    {% else %}
                    <div class="w-full h-full flex items-center justify-center">
                        <svg class="w-8 h-8 text-warm-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14"/>
                        </svg>
                    </div>
                    {% endif %}
                </a>
                <div class="flex-1 min-w-0">
                    <a href="{{ painting.get_absolute_url }}" class="font-display font-medium text-charcoal dark:text-white hover:text-warm-600 dark:hover:text-warm-300 line-clamp-1">{{ painting.title }}</a>
                    {% if painting.purchaser_name %}<p class="font-medium text-warm-700 dark:text-warm-200 mt-1">{{ painting.purchaser_name }}</p>{% endif %}
                    {% if painting.purchaser_city %}<p class="text-sm text-warm-500">{{ painting.purchaser_city }}</p>{% endif %}
                    {% if painting.purchase_comment %}<p class="text-sm text-warm-600 dark:text-warm-400 mt-2 italic">« {{ painting.purchase_comment }} »</p>{% endif %}
                    {% if painting.purchase_date %}<p class="text-xs text-warm-400 mt-2">{{ painting.purchase_date|date:"F Y" }}</p>{% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_css %}
<style>
    .scroll-fade-in {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }

    .scroll-fade-in.visible {
        opacity: 1;
        transform: translateY(0);
    }

    .scroll-fade-in-card {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }

    .scroll-fade-in-card.visible {
        opacity: 1;
        transform: translateY(0);
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const sections = document.querySelectorAll('.scroll-fade-in, .scroll-fade-in-card');

        const observerOptions = {
            threshold: 0.15,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const delay = entry.target.dataset.delay ? parseInt(entry.target.dataset.delay) * 100 : 0;
                    setTimeout(() => {
                        entry.target.classList.add('visible');
                    }, delay);
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        sections.forEach(section => {
            observer.observe(section);
        });

        function checkInitialVisibility() {
            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                const isVisible = rect.top < window.innerHeight * 0.8 && rect.bottom > 0;
                if (isVisible && !section.classList.contains('visible')) {
                    section.classList.add('visible');
                }
            });
        }

        checkInitialVisibility();
        setTimeout(checkInitialVisibility, 100);
    });
</script>
{% endblock %}
